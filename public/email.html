<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Email Recs</title>
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <script>
        //this is needed to clear our the cookies so you dont have viewedIds or shopperIds in the request so we can intercept it.
        document.cookie = 'ssShopperId=; Max-Age=-99999999;';
    </script>

    <script id="searchspring-context" src="bundle.js">
        config = {
            instantiators: {
                recommendation: {
                    config: {
                        branch: "development"
                    }
                }
            }
        }
    </script>
    
    <script>

        const config = {
            // To test an email component. Simply put the component name here, and the siteId used in the root index.js
            component: "Email",
            siteID: '{{snapfu.siteId}}',
            //If you want to test with specific products, you can put the data here, otherwise leave out and it will autofetch trending products. 
            // results: [{"id":"175547","mappings":{"core":{"uid":"175547","name":"Off She Goes White Skinny Jeans","sku":"C-JU-W1-P1034","msrp":75,"price":58,"thumbnailImageUrl":"https://searchspring-demo-content.s3.amazonaws.com/demo/fashion/product_images_thumb_med/use_3_thumb_med.jpg","url":"/product/C-JU-W1-P1034","rating":"5","brand":"Just USA","popularity":4455,"imageUrl":"https://searchspring-demo-content.s3.amazonaws.com/demo/fashion/product_images_large/use_3_large.jpg","ratingCount":1111}},"attributes":{}}],
        }

        if (!config.siteID) {
            console.error('No siteId found. Please check you email.html config.');
        }else {
            const profile = "trending";
            const { results, component, siteID, currentBranch } = config;
            const profileResponse = {"profile":{"tag":profile,"display":{"template":{"component":component},"templateParameters":{}}}};
            const profileKey = `/api/personalized-recommendations/profile.json{"tag":"${profile}","siteId":"${siteID}","branch":"development"}`;

            searchspring.client.requesters.recommend.cache.set(profileKey, profileResponse);

            if (config.results) {
                const recommendResponse = [{"results":results,"profile":{"tag":profile}}];
                const recommendKey = `/boost/${siteID}/recommend{"tags":["${profile}"],"limits":[20],"siteId":"${siteID}","test":true}`;
                searchspring.client.requesters.recommend.cache.set(recommendKey, recommendResponse);
            }
        }
    </script>

</head>

<body class="ss-lite-site">
    <script type="searchspring/recommend" profile="trending"></script>
</body>

</html>